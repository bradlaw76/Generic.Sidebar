<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Generic.Sidebar Agent — How to use</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="How to use the Generic.Sidebar Copilot agent to ask questions and submit GitHub issues." />
  <style>
    :root {
      --bg: #ffffff;
      --text: #111827;      /* gray-900 */
      --muted: #6b7280;     /* gray-500 */
      --border: #e5e7eb;    /* gray-200 */
      --accent: #2563eb;    /* blue-600 */
      --code-bg: #f8fafc;   /* slate-50 */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg); color: var(--text);
    }
    .wrap { max-width: 860px; margin: 0 auto; padding: 24px 20px 56px; }
    header { padding: 28px 0 12px; border-bottom: 1px solid var(--border); margin-bottom: 16px; }
    h1 { font-size: clamp(26px, 3vw, 36px); margin: 0 0 6px; }
    p.muted { color: var(--muted); margin: 0; }
    .cta-row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-top: 14px; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border);
      text-decoration: none; font-weight: 600; color: #fff; background: var(--accent);
    }
    .btn.secondary { background: transparent; color: var(--text); }
    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 10px; border-radius: 999px; border: 1px solid var(--border);
      background: #fff; color: var(--text); font-weight: 600; font-size: 14px;
    }
    .badge small { color: var(--muted); font-weight: 500; }
    section.card {
      border: 1px solid var(--border); border-radius: 14px; padding: 18px; margin-top: 16px; background: #fff;
    }
    h2 { font-size: 22px; margin: 0 0 10px; }
    ul, ol { margin: 8px 0 0 20px; }
    li + li { margin-top: 6px; }
    kbd {
      background: #f3f4f6; border: 1px solid var(--border); border-bottom-width: 3px;
      border-radius: 6px; padding: 2px 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 13px;
    }
    pre {
      background: var(--code-bg); border: 1px solid var(--border); border-radius: 10px;
      padding: 12px; overflow: auto; margin: 8px 0 0;
    }
    footer { margin-top: 28px; border-top: 1px solid var(--border); padding-top: 12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Generic.Sidebar Agent — How to use</h1>
      <p class="muted">The bot is embedded but does not auto-start. Send a first message (e.g., <kbd>help</kbd>) to begin.</p>
      <div class="cta-row">
        <a class="btn" href="https://bradlaw76.github.io/Generic.Sidebar/pages/copilot/index.html" target="_blank" rel="noopener">Open the Bot</a>
        <a class="btn secondary" href="https://github.com/bradlaw76/Generic.Sidebar/issues" target="_blank" rel="noopener">View Repo Issues</a>
        <span id="downloadBadge" class="badge" aria-live="polite" title="Total downloads across all releases">
          <small>Downloads</small> —
        </span>
      </div>
    </header>

    <!-- Section 1 -->
    <section class="card">
      <h2>Submit Generic.Sidebar issues to GitHub</h2>
      <ol>
        <li>Click <strong>Open the Bot</strong> (above).</li>
        <li>If nothing appears in the chat, type <kbd>help</kbd> or any greeting (e.g., <kbd>hi</kbd>) to start.</li>
        <li>Ask the agent to create or update an issue. Examples:
          <ul>
            <li>Create: <kbd>Create a GitHub issue titled "Default flag flow loops" with description "Flow updates record repeatedly when Default=true and StartDate is null."</kbd></li>
            <li>Update: <kbd>Update GitHub issue #123: add label bug and assign to @bradlaw76</kbd></li>
          </ul>
        </li>
      </ol>
      <p class="muted">Notes: The agent uses MCP to call a GitHub tool with a token you control. It will post issues to <code>bradlaw76/Generic.Sidebar</code> (unless configured otherwise).</p>
    </section>

    <!-- Section 2 -->
    <section class="card">
      <h2>FAQ</h2>
      <ul>
        <li><strong>The bot doesn’t greet me. Is it broken?</strong><br/>
            No—auto-start is disabled. Just type <kbd>help</kbd> (or any message) to begin.</li>
        <li><strong>Where do my issues go?</strong><br/>
            To the GitHub repository configured for the agent (default: <code>bradlaw76/Generic.Sidebar</code>).</li>
        <li><strong>Can it update existing issues?</strong><br/>
            Yes. Refer to an issue by number (e.g., <kbd>#123</kbd>) or ask the agent to search by title.</li>
        <li><strong>Can it add labels or assignees?</strong><br/>
            Yes—include instructions in your request (e.g., <kbd>add label bug</kbd>, <kbd>assign to @username</kbd>).</li>
        <li><strong>Can I attach files?</strong><br/>
            The agent can include links and text. File uploads depend on your MCP implementation.</li>
      </ul>
    </section>

    <footer>
      <p class="muted">© <span id="y"></span> Generic.Sidebar · Need help? Open an <a href="https://github.com/bradlaw76/Generic.Sidebar/issues" target="_blank" rel="noopener">issue</a>.</p>
    </footer>
  </div>

  <script>
    // Year
    document.getElementById('y').textContent = new Date().getFullYear();

    // --- Total download count badge ---
    (async function () {
      const owner = 'bradlaw76';
      const repo = 'Generic.Sidebar';
      const badge = document.getElementById('downloadBadge');

      function parseNext(linkHeader) {
        if (!linkHeader) return null;
        const nextPart = linkHeader.split(',').map(s => s.trim()).find(s => s.endsWith('rel="next"'));
        if (!nextPart) return null;
        const m = nextPart.match(/<([^>]+)>/);
        return m ? m[1] : null;
      }

      async function fetchTotalDownloads() {
        let url = `https://api.github.com/repos/${owner}/${repo}/releases?per_page=100`;
        let total = 0;

        while (url) {
          const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } });
          if (!res.ok) throw new Error('GitHub API error ' + res.status);
          const releases = await res.json();
          for (const r of releases) {
            if (r.draft) continue; // ignore drafts
            if (Array.isArray(r.assets)) {
              for (const a of r.assets) total += (a.download_count || 0);
            }
          }
          url = parseNext(res.headers.get('Link'));
        }
        return total;
      }

      try {
        badge.innerHTML = '<small>Downloads</small> …';
        const total = await fetchTotalDownloads();
        badge.innerHTML = `<small>Downloads</small> ${total.toLocaleString()}`;
      } catch (e) {
        console.error(e);
        badge.innerHTML = '<small>Downloads</small> n/a';
        badge.title = 'Could not fetch downloads';
      }
    })();
  </script>
</body>
</html>
