<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generic.Sidebar</title>
  <meta name="description" content="Generic Sidebar for Dynamics 365 â€” a flexible, table-driven side pane for model-driven apps." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“‹</text></svg>" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
  <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-blue-600 text-white px-4 py-2 rounded z-50">Skip to content</a>
  <nav class="bg-white border-b border-gray-200 px-6 py-3">
    <div class="max-w-5xl mx-auto flex items-center gap-6 text-sm font-medium text-gray-600">
      <a href="/Generic.Sidebar/" class="text-gray-900 font-semibold">Home</a>
      <a href="/Generic.Sidebar/downloads/" class="hover:text-gray-900">Downloads</a>
      <a href="/Generic.Sidebar/pages/agent/" class="hover:text-gray-900">Agent</a>
      <a href="/Generic.Sidebar/pages/copilot/" class="hover:text-gray-900">Copilot</a>
    </div>
  </nav>
  <main id="main" class="max-w-5xl mx-auto px-6 py-12">
    <header class="mb-12 text-center">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">Generic.Sidebar</h1>
      <p class="text-lg text-gray-600">A project by <span class="font-medium">bradlaw76</span></p>
    </header>

    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">About</h2>
      <p class="text-gray-700 leading-relaxed">
        Generic.Sidebar is an open-source project designed to simplify and enhance sidebar functionality for modern web applications. It integrates seamlessly, offers flexibility, and provides a foundation for extending custom features.
      </p>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Get Started</h2>
      <p class="text-gray-700 leading-relaxed mb-4">
        Explore the repository, check out tagged releases, and get started by downloading the latest version.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="https://github.com/bradlaw76/Generic.Sidebar" target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center justify-center px-6 py-3 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700">
          View Repository
        </a>
        <a href="https://github.com/bradlaw76/Generic.Sidebar/tags" target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center justify-center px-6 py-3 rounded-lg bg-gray-800 text-white font-medium hover:bg-gray-900">
          View Releases & Tags
        </a>
      </div>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Contributing</h2>
      <p class="text-gray-700 leading-relaxed">
        Contributions are welcome! Feel free to fork the repository, open issues, and submit pull requests. Your feedback and enhancements help make Generic.Sidebar better for everyone.
      </p>
    </section>

    <!-- Statistics Section -->
    <section class="mt-16">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Release Statistics</h2>
      <p class="text-gray-600 text-center mb-6">Track downloads for Generic.Sidebar releases.</p>
      <div class="bg-white border border-gray-200 rounded-lg p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-medium text-gray-900">Downloads Overview</h3>
          <button id="toggleLegendButton" class="text-sm px-3 py-1 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200">Toggle Legend</button>
        </div>
        <div class="relative h-96 mb-6">
          <canvas id="releaseChart" aria-label="Line chart showing download counts per release" role="img"></canvas>
        </div>
        <div class="flex justify-between items-center mb-2">
          <h3 class="text-lg font-medium text-gray-900">Release Data Table</h3>
          <button id="exportCsvBtn" class="text-sm px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50">Export CSV</button>
        </div>
        <div class="overflow-x-auto overflow-y-auto max-h-96 border border-gray-200 rounded-md">
          <table id="releaseTable" class="min-w-full text-sm">
            <thead class="bg-gray-50 text-gray-600">
              <tr>
                <th scope="col" class="px-4 py-2 text-left">Release Date</th>
                <th scope="col" class="px-4 py-2 text-left">Tag</th>
                <th scope="col" class="px-4 py-2 text-left">Release</th>
                <th scope="col" class="px-4 py-2 text-left">Asset</th>
                <th scope="col" class="px-4 py-2 text-left">Downloads</th>
                <th scope="col" class="px-4 py-2 text-left">Total Downloads</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <footer class="mt-16 py-6 border-t text-center text-gray-500 text-sm">
    Â© <span id="year"></span> Generic.Sidebar by bradlaw76
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // === Stats Script ===
    const REPO = "bradlaw76/Generic.Sidebar";
    let chart;
    let releaseData = [];

    async function fetchReleases() {
      const res = await fetch(`https://api.github.com/repos/${REPO}/releases?per_page=30`);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    function processData(releases) {
      return releases.map(r => {
        const totalDownloads = (r.assets || []).reduce((s,a) => s + (a.download_count||0), 0);
        return {
          date: new Date(r.published_at).toISOString().split('T')[0],
          tag: r.tag_name,
          name: r.name || r.tag_name,
          url: r.html_url,
          assets: (r.assets||[]).map(a => ({name: a.name, downloads: a.download_count, url: a.browser_download_url})),
          total: totalDownloads
        };
      });
    }

    function updateChart(data){
      const ctx = document.getElementById('releaseChart').getContext('2d');
      const labels = data.map(r => r.tag).reverse();
      const datasets = [];
      const assetNames = [...new Set(data.flatMap(r => r.assets.map(a => a.name)))];
      assetNames.forEach((name,i)=>{
        datasets.push({
          label: name,
          data: data.map(r => (r.assets.find(a=>a.name===name)?.downloads)||0).reverse(),
          borderColor: `hsl(${i*137.5}deg,70%,50%)`,
          fill: false
        });
      });
      datasets.unshift({
        label: 'Total Downloads',
        data: data.map(r => r.total).reverse(),
        borderColor: 'rgb(75,192,192)',
        backgroundColor: 'rgba(75,192,192,0.2)',
        fill: true,
        borderWidth: 3,
        pointRadius: 4
      });
      if(chart) chart.destroy();
      chart = new Chart(ctx,{type:'line',data:{labels,datasets},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});
    }

    function updateTable(data){
      const tbody = document.querySelector('#releaseTable tbody');
      tbody.innerHTML = '';
      data.forEach(r=>{
        r.assets.forEach(a=>{
          const tr = document.createElement('tr');

          const tdDate = document.createElement('td');
          tdDate.className = 'px-4 py-2';
          tdDate.textContent = r.date;

          const tdTag = document.createElement('td');
          tdTag.className = 'px-4 py-2 font-medium';
          tdTag.textContent = r.tag;

          const tdRelease = document.createElement('td');
          tdRelease.className = 'px-4 py-2';
          const linkRel = document.createElement('a');
          linkRel.href = r.url;
          linkRel.target = '_blank';
          linkRel.rel = 'noopener noreferrer';
          linkRel.className = 'text-blue-600 hover:underline';
          linkRel.textContent = r.name;
          tdRelease.appendChild(linkRel);

          const tdAsset = document.createElement('td');
          tdAsset.className = 'px-4 py-2';
          const linkAsset = document.createElement('a');
          linkAsset.href = a.url;
          linkAsset.target = '_blank';
          linkAsset.rel = 'noopener noreferrer';
          linkAsset.className = 'text-blue-600 hover:underline';
          linkAsset.textContent = a.name;
          tdAsset.appendChild(linkAsset);

          const tdDownloads = document.createElement('td');
          tdDownloads.className = 'px-4 py-2';
          tdDownloads.textContent = a.downloads;

          const tdTotal = document.createElement('td');
          tdTotal.className = 'px-4 py-2';
          tdTotal.textContent = r.total;

          tr.append(tdDate, tdTag, tdRelease, tdAsset, tdDownloads, tdTotal);
          tbody.appendChild(tr);
        });
      });
    }

    async function loadStats(){
      try{
        const releases = await fetchReleases();
        releaseData = processData(releases);
        updateChart(releaseData);
        updateTable(releaseData);
      }catch(e){
        console.error(e);
      }
    }

    document.getElementById('toggleLegendButton').addEventListener('click',()=>{
      if(chart){chart.options.plugins.legend.display=!chart.options.plugins.legend.display;chart.update();}
    });
    document.getElementById('exportCsvBtn').addEventListener('click',()=>{
      if(!releaseData.length) return;
      const header=['Release Date','Tag','Name','Asset','Downloads','Total Downloads'];
      const rows=releaseData.flatMap(r=>r.assets.map(a=>[r.date,r.tag,r.name,a.name,a.downloads,r.total]));
      const csv=[header,...rows].map(r=>r.map(cell=>{
        const s=String(cell);
        const needsQuote=/[",\n]/.test(s);
        let v=s.replace(/"/g,'""');
        return needsQuote?`"${v}"`:v;
      }).join(',')).join('\n');
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const link=document.createElement('a');
      link.href=URL.createObjectURL(blob);
      link.download='Generic.Sidebar_stats.csv';
      link.click();
    });

    loadStats();
  </script>
</body>
</html>
